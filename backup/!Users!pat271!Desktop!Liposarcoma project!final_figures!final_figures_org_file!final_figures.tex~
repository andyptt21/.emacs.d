% Created 2019-01-07 Mon 15:14
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\author{Andrew Patt}
\date{\today}
\title{Final figures for liposarcoma paper}
\hypersetup{
 pdfauthor={Andrew Patt},
 pdftitle={Final figures for liposarcoma paper},
 pdfkeywords={},
 pdfsubject={These are just the figures which will be in the final paper, with minor edits to ensure consistency of font size, etc.},
 pdfcreator={Emacs 25.3.1 (Org mode 9.1.14)}, 
 pdflang={English}}
\begin{document}

\maketitle
\tableofcontents


\section{{\bfseries\sffamily TODO} Remove black color from 2c}
\label{sec:org3612245}
\section{{\bfseries\sffamily TODO} Make bars in bar plots have same vertical height}
\label{sec:orge61e87d}
\section{Figure 1 "Tumors with high or low MDM2 amplification show distinct metabolomics profiles"}
\label{sec:orgee80225}
\subsection{Figure 1B}
\label{sec:org6f4b9bf}
\begin{verbatim}
library(ggplot2)
\end{verbatim}

\subsection{Figure 1C}
\label{sec:orgbbfbc44}
\begin{verbatim}
load("~/Desktop/Liposarcoma project/final_figures/final_figures_org_file/figure1C.Rda")

ggplot(resMDM2HiLoSig,aes(x=reorder(name,log2fc), y=log2fc, fill = Class)) +
    ggtitle("Significant MDM2 Hi/Lo Metabolites") +
    geom_bar(stat = "identity", colour = "black") +
    coord_flip() +
    theme_bw() +
    ylab("log2(mean(MDM2hi)-mean(MDM2lo))") +
    theme(axis.title.y = element_blank(),axis.title.x = element_text(size=12,face="bold"),axis.text.y=element_text(size=10,face="bold"),axis.text.x=element_text(size=10)) +
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
    scale_fill_manual(values=as.vector(myPalette)[c(1,2,5,3,4,6,7)]) +
    theme(legend.position="bottom",legend.direction="vertical")
\end{verbatim}

\begin{center}
\includegraphics[width=.9\linewidth]{Figure1C.pdf}
\end{center}

\section{Figure 2: "DDLPS cell lines with high MDM2 amplification respond poorly to MDM2 inhibition"}
\label{sec:org6eac3bd}
\subsection{Figure 2B}
\label{sec:orgb1cab0c}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2B.pdf}
\end{center}

\subsection{Figure 2C}
\label{sec:org29f6b47}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2C.pdf}
\end{center}

\subsection{Figure 2D}
\label{sec:orgfabd271}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2D.pdf}
\end{center}

\section{Figure 3: "DDLPS cell lines respond to cholesterol inhibition"}
\label{sec:org86c2408}
\subsection{Figure 3B}
\label{sec:org2300dec}
\subsubsection{Custom version of volcano plotter}
\label{sec:org5d80d19}
\begin{verbatim}
volcano_plotter <- function(df,gp1,gp2,title){
    T_test_results<-mydiff(df,gp1,gp2)
    ## Make insignificant points smaller and more transparent
    T_test_results$significant = abs(T_test_results$log2fc) > 1 & -log10(T_test_results$mypadj) > -log10(0.1)
    T_test_results$size <- ifelse(T_test_results$significant,4,2)

    ## Color code by lipid class
    T_test_results$MainClass<-lipidomic_key$`LM Main Class`[match(T_test_results$name,lipidomic_key$name)]
    palette_names<-sort(unique(T_test_results$MainClass))
    T_test_results$MainClass<-sapply(1:nrow(T_test_results),function(x){
	ifelse(T_test_results$significant[x],
	       return(T_test_results$MainClass[x]),return("Not Significant"))
    })

    ## legend_labels<-sort(unique(sapply(T_test_results$MainClass, function(x){
    ##     if(!is.na(x)){
    ##         return(paste0(x," (n=",length(which(T_test_results$MainClass==x)),")"))
    ##     }else{
    ##         return(x)
    ##     }
    ## })))
    legend_labels<-sort(unique(T_test_results$MainClass))

    palette<-c(brewer.pal(12,"Paired"),"#40E0D0","violet","grey80")
    names(palette)<-c(palette_names,"Not Significant")
    palette<-palette[unique(T_test_results$MainClass)]

    if(any(T_test_results$significant)){
	g = ggplot(data=T_test_results, aes(x=log2fc, y=-log10(mypadj), colour=MainClass)) +
	    geom_point(alpha=0.7,aes(size=size, text=name)) +
	    scale_color_manual(values = palette,
			       ##na.value="grey80",
			       labels=legend_labels,
			       name="LipidMaps Main Class") +
	    theme_bw() +
	    ggtitle(title) +
	    theme(plot.title = element_text(hjust = 0.5)) +
	    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
	    ylab("-log10 p-value") +
	    geom_hline(yintercept = -log10(0.1),lty = 2) +
	    geom_vline(xintercept = 1, lty = 2) +
	    geom_vline(xintercept = -1, lty = 2) +
	    scale_size(range=c(2,4)) +
	    guides(size=FALSE)
    }else{
	g = ggplot(data=T_test_results, aes(x=log2fc, y=-log10(mypadj))) +
	    geom_point(alpha=0.4,aes(text=name)) +
	    scale_color_manual(values = palette) +
	    theme_bw() +
	    ggtitle(title) +
	    theme(plot.title = element_text(hjust = 0.5)) +
	    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
	    ylab("-log10 p-value") +
	    geom_hline(yintercept = -log10(0.1),lty = 2) +
	    geom_vline(xintercept = 1, lty = 2) +
	    geom_vline(xintercept = -1, lty = 2)
	return(g)
    }

    T_test_results_sig<-T_test_results[T_test_results$significant,]
    text_size<-round(min(20,350/nrow(T_test_results_sig)),digits=0)
    barplot<-ggplot(T_test_results_sig, aes(x=reorder(name,log2fc), y=log2fc ))+
	theme_bw() +
	geom_bar(stat="identity",colour="black",aes(fill = MainClass)) +
	scale_fill_manual(values = palette) +
	coord_flip() +
	ylab("log2fc") +
	theme(axis.title.y = element_blank(),axis.title.x = element_text(size=12,face="bold"),axis.text.y=element_text(size=text_size),axis.text.x=element_text(size=10)) +
	theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

    return(list(g,barplot))
}
\end{verbatim}

\subsubsection{Figure}
\label{sec:orgc7c96ea}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure3B.pdf}
\end{center}

\subsection{Figure 3C (Treated vs. Untreated lipids, MDM2 low, sterol-deprived media)}
\label{sec:org6e34d5a}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure3C.pdf}
\end{center}

\section{Figure 4: "Lipidome analysis in DDLPS cell lines"}
\label{sec:org2624e5b}
\subsection{Figure 4A}
\label{sec:org8070f84}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure4A.pdf}
\end{center}
\subsection{Figure 4B}
\label{sec:orge554483}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure4B.pdf}
\end{center}

\subsection{Figure 4C}
\label{sec:orgef439e7}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure4C.pdf}
\end{center}

\subsection{Figure 4D}
\label{sec:org2880319}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure4D.pdf}
\end{center}
\end{document}