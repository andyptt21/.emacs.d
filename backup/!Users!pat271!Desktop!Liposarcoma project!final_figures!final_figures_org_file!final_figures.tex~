% Created 2019-04-17 Wed 14:14
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\author{Andrew Patt}
\date{\today}
\title{Final figures for liposarcoma paper}
\hypersetup{
 pdfauthor={Andrew Patt},
 pdftitle={Final figures for liposarcoma paper},
 pdfkeywords={},
 pdfsubject={These are just the figures which will be in the final paper, with minor edits to ensure consistency of font size, etc.},
 pdfcreator={Emacs 26.2 (Org mode 9.2)}, 
 pdflang={English}}
\begin{document}

\maketitle
\tableofcontents


\section{MDM2 Hi vs. Low Comparisons [9/9]}
\label{sec:org2fc1703}
\begin{itemize}
\item[{$\boxtimes$}] DMEM/Untreated (lipidomics, univariate)  \textbf{Fig 3B (VP)}
\item[{$\boxtimes$}] DMEM/Untreated (metabolomics, univariate) \textbf{Fig 1C (Barplot)}
\item[{$\boxtimes$}] Correlate DMEM/Untreated changes in lipidomics vs. metabolomics \textbf{Additional Figure}
\item[{$\boxtimes$}] DMEM/Treated \textbf{Fig 3B}
\item[{$\boxtimes$}] DMEM/Untreated \textbf{Fig 3B}
\item[{$\boxtimes$}] Venn Diagram of DMEM/Treated vs Untreated \textbf{Fig3E}
\item[{$\boxtimes$}] STDP/Untreated \textbf{Fig S3B}
\item[{$\boxtimes$}] DMEM/Treated \textbf{Fig S3B}
\item[{$\boxtimes$}] Venn Diagram of STDP/Untreated vs DMEM/Untreated \textbf{Fig S3D}
\end{itemize}

\section{Figure 1 "Tumors with high or low MDM2 amplification show distinct metabolomics profiles"}
\label{sec:org418e33e}
\subsection{Figure 1B}
\label{sec:org1e11cfc}
\begin{verbatim}
library(ggplot2)
library(RaMP)  
load("~/Desktop/Liposarcoma project/final_figures/data/fishersResults.Rda")

combinedPathwaysSig <- FilterFishersResults(combinedFishers,
					    p_fdradj_cutoff=0.1)
threshold <- 0.05

fishresult <- combinedPathwaysSig$fishresult #fishresult <-
fishresult[which(fishresult$Pval <= threshold),]

fishClustering<-list(fishresults=fishresult,analyte_type="both")
fishClustering<-findCluster(fishClustering,perc_analyte_overlap=0.2,perc_pathway_overlap=0.2)
length(fishClustering$cluster_list)

fishresult <- fishClustering$fishresults

bubbleDF <- data.frame(x=-log10(fishresult$Pval),
		       y=fishresult$pathwayName, inPath <-
		       fishresult$Num_In_Path, totPath <-
		       fishresult$Total_In_Path,
		       cluster=fishresult$cluster_assignment)
library(dplyr)
library(tidyr)

bubbleDF <- bubbleDF[order(bubbleDF$x, decreasing = TRUE),]

bubbleDF <- bubbleDF %>% separate_rows(cluster,sep=", ")

bubbleDF$cluster <- sapply(bubbleDF$cluster, function(x)
ifelse(x=="Did not cluster", return(x),
return(paste0("Cluster ",x))))

fig1B <- ggplot(bubbleDF,aes(y=x,x=reorder(y,x), fill = cluster)) +
  geom_bar(stat = "identity", colour = "black",position =
						 "dodge", width = 0.75) +
      #geom_hline(yintercept=-log10(0.1),linetype = "dotted") +
  theme_bw() + coord_flip() + labs(x = "", y = "-log10(pval)") +
  theme(axis.line = element_line(colour = "black"),
	axis.title=element_text(size=12,face="bold"),
	plot.title=element_text(size=14,face="bold"),
	axis.text.y=element_text(face="bold"), panel.grid.minor =
						 element_blank(), legend.position = "none", panel.background =
											      element_blank()) +
  scale_fill_brewer(palette="Set1") +
  facet_grid(cluster~.,space="free",scales="free") +
  theme(strip.text.y = element_text(size = 6))
fig1B

\end{verbatim}

\subsection{Figure 1C}
\label{sec:org3649647}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure1C.pdf}
\end{center}

\subsection{Figure 1}
\label{sec:org18af6e2}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure1.pdf}
\end{center}

\section{Figure 2: "DDLPS cell lines with high MDM2 amplification respond poorly to MDM2 inhibition"}
\label{sec:orgfb67e18}
\subsection{Figure 2B}
\label{sec:org1c5bf72}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2B.pdf}
\end{center}

\subsection{Figure 2C}
\label{sec:org38618d5}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2C.pdf}
\end{center}

\subsection{Figure 2D}
\label{sec:org390f3a5}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2D.pdf}
\end{center}
\subsection{Figure 2}
\label{sec:org4300881}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure2.pdf}
\end{center}

\section{Figure 3: "DDLPS cell lines respond to cholesterol inhibition"}
\label{sec:org7280d68}
\subsection{Figure 3B}
\label{sec:org75d5048}
\subsubsection{Custom version of volcano plotter}
\label{sec:org44e8114}
\subsubsection{Figure}
\label{sec:org65d1d97}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure3B.pdf}
\end{center}

\subsection{Figure 3C (Treated vs. Untreated lipids, MDM2 high, normal media)}
\label{sec:orgc77ac79}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure3C.pdf}
\end{center}
\subsection{Figure 3D (Treated vs. Untreated lipids, MDM2 low, sterol-deprived media)}
\label{sec:orge96316e}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure3D.pdf}
\end{center}
\subsection{Figure 3}
\label{sec:orgabfe8b9}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure3.pdf}
\end{center}
\subsection{Fig 3 Venn Diagrams}
\label{sec:org23e6348}
\begin{verbatim}
library(ggforce)
untreated_DMEM <-  mydiff(LM_area, 
			  groupMDM2Hi_Untreated_DMEM,
			  groupMDM2Lo_Untreated_DMEM)

treated_DMEM <-  mydiff(LM_area, 
			groupMDM2Hi_Treated_DMEM,
			groupMDM2Lo_Treated_DMEM)

untreated_DMEM_sig <- untreated_DMEM %>%
  filter(mypadj < 0.05, log2fc > 1)

treated_DMEM_sig <- treated_DMEM %>%
  filter(mypadj < 0.05, log2fc > 1)

df.venn <- data.frame(x = c(1.2, -1.2),
		      y = c(0, 0),
		      labels = c('Untreated', 'Treated'))
intersect_count = length(intersect(untreated_DMEM_sig$name,treated_DMEM_sig$name))
df.vdc<-data.frame(Count = c(intersect_count,
			     nrow(treated_DMEM_sig)-intersect_count,
			     nrow(untreated_DMEM_sig)-intersect_count),
		   x = c(0, -1.3, 1.3),
		   y = c(0,0,0))

fig3E.1 <- ggplot(df.venn, aes(x0 = x, y0 = y, r = 1.5, fill = labels)) +
  scale_fill_brewer(palette="Dark2") +
  geom_circle(alpha = .5, size = 1, colour = 'grey') +
  coord_fixed() +
  theme_void() +
  labs(fill = NULL) +
  annotate("text", x = df.vdc$x, y = df.vdc$y, label = df.vdc$Count, size = 7) +
  ggtitle("Lipids upregulated in MDM2 High cells compared to MDM2 Low (Standard Media)")

untreated_DMEM_sig <- untreated_DMEM %>%
  filter(mypadj < 0.05, log2fc < -1)

treated_DMEM_sig <- treated_DMEM %>%
  filter(mypadj < 0.05, log2fc < -1)

df.venn <- data.frame(x = c(1.2, 0),
		      y = c(0, 0),
		      r = c(1,1.2),
		      labels = c('Untreated', 'Treated'))
intersect_count = length(intersect(untreated_DMEM_sig$name,treated_DMEM_sig$name))
df.vdc<-data.frame(Count = c(intersect_count,
			     nrow(treated_DMEM_sig)-intersect_count,
			     nrow(untreated_DMEM_sig)-intersect_count),
		   x = c(1, -.3, 1.8),
		   y = c(0,0,0))
fig3E.2 <- ggplot(df.venn, aes(x0 = x, y0 = y, r = r, fill = labels)) +
  scale_fill_brewer(palette="Dark2") +
  geom_circle(alpha = .5, size = 1, colour = 'grey') +
  coord_fixed() +
  theme_void() +
  labs(fill = NULL) +
  annotate("text", x = df.vdc$x, y = df.vdc$y, label = df.vdc$Count, size = 7) +
  ggtitle("Lipids upregulated in MDM2 Low cells compared to MDM2 High (Standard Media)")

plot_grid(fig3E.1,
	  fig3E.2,
	  ncol=1)

\end{verbatim}

\section{Figure 5: "Involvement of sphingolipid synthesis in humans"}
\label{sec:org017d63b}
\subsection{Figure 5A}
\label{sec:org39da702}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure5A.pdf}
\end{center}
\subsection{Figure 5}
\label{sec:orgd266ad7}
\begin{center}
\includegraphics[width=.9\linewidth]{Figure5.pdf}
\end{center}

\section{Figure S1: "MDM2 status and metabolomic profiling in DDLPS cell lines"}
\label{sec:org0d98b9b}
\subsection{Figure S1B}
\label{sec:orgb0b9cf6}
\begin{verbatim}
metabolon_superpathways <- read_csv("~/Desktop/Liposarcoma project/final_figures/final_figures_org_file/Metabolon_superpathways.csv")
colnames(metabolon_superpathways) <- "pathway"
metabolon_superpathways <- within(metabolon_superpathways, 
				  pathway <- factor(pathway,levels=names(sort(table(pathway), decreasing=TRUE))))
figS1B <- ggplot(metabolon_superpathways, aes(pathway)) +
    geom_histogram(stat="count",color="black",fill="gray") +
    theme(axis.text.x=element_text(angle=45,hjust=1)) +
    labs(x = "Metabolon Superpathway",y = "# of Metabolites")
figS1B	
\end{verbatim}

\subsection{Figure S1C}
\label{sec:orgf6df70e}
\begin{verbatim}
mycol=c("red","blue")
mytitle="MDM2 high and low cell lines, untreated"
load("~/Desktop/Liposarcoma project/final_figures/final_figures_org_file/figureS1C.Rda")
figS1C <- ggplot(mydf,aes(PC1,PC2,color=Status,shape=Cell)) +
  geom_point(aes(PC1,PC2,shape=Cell),size=4) +
  scale_color_manual(values=mycol) +
  xlab(paste0("PC1: ",percvar[1],"% variance")) +
  ylab(paste0("PC2: ",percvar[2],"% variance")) +
  theme_bw() +
  ggtitle(mytitle) +
  theme(axis.line = element_line(colour = "black"),
	axis.title=element_text(size=12,face="bold"),
	plot.title=element_text(size=14,face="bold"),
	panel.grid.major = element_blank(),
	panel.grid.minor = element_blank(),
	panel.background = element_blank())
figS1C

\end{verbatim}

\subsection{Figure S1D}
\label{sec:org966260d}
\begin{verbatim}
load("~/Desktop/Liposarcoma project/final_figures/final_figures_org_file/figureS1D.Rda")
figS1D <- plot_grid(boxplotter("glycosyl-N-palmitoyl-sphingosine"),
		    boxplotter("glycosyl-N-stearoyl-sphingosine"),
		    boxplotter("sphingomyelin (d18:1/17:0, d17:1/18:0, d19:1/16:0)"),
		    nrow=1)
figS1D
\end{verbatim}

\subsection{Figure S1}
\label{sec:orgeb5441d}
\begin{center}
\includegraphics[width=.9\linewidth]{FigureS1.pdf}
\end{center}

\section{Figure S3: "Lipidome analysis in DDLPS cell lines"}
\label{sec:orgd7fef03}
\subsection{Figure S3A}
\label{sec:orga4dc242}
\begin{center}
\includegraphics[width=.9\linewidth]{FigureS3A.pdf}
\end{center}
\subsection{Figure S3B}
\label{sec:orga1a49ce}
\begin{center}
\includegraphics[width=.9\linewidth]{FigureS3B.pdf}
\end{center}

\subsection{Figure S3C}
\label{sec:orgc7baa85}
\begin{center}
\includegraphics[width=.9\linewidth]{FigureS3C.pdf}
\end{center}
\subsection{Figure S3}
\label{sec:org8b97d4a}
\begin{center}
\includegraphics[width=.9\linewidth]{FigureS3.pdf}
\end{center}

\subsection{Venn Diagrams}
\label{sec:org89dde9e}
\begin{verbatim}

untreated_STDP <-  mydiff(LM_area, 
			  groupMDM2Hi_Untreated_STDP,
			  groupMDM2Lo_Untreated_STDP)

untreated_DMEM_sig <- untreated_DMEM %>%
  filter(mypadj < 0.05, log2fc > 1)

untreated_STDP_sig <- untreated_STDP %>%
  filter(mypadj < 0.05, log2fc > 1)

df.venn <- data.frame(x = c(.8, -.8),
		      y = c(0, 0),
		      labels = c('Standard Media', 'Sterol-Deprived Media'))
intersect_count = length(intersect(untreated_STDP_sig$name,untreated_DMEM_sig$name))
df.vdc<-data.frame(Count = c(intersect_count,
			     nrow(untreated_STDP_sig)-intersect_count,
			     nrow(untreated_DMEM_sig)-intersect_count),
		   x = c(0, -1.3, 1.3),
		   y = c(0,0,0))

figS3D.1 <- ggplot(df.venn, aes(x0 = x, y0 = y, r = 1.5, fill = labels)) +
    scale_fill_brewer(palette="Dark2") +
    geom_circle(alpha = .5, size = 1, colour = 'grey') +
    coord_fixed() +
    theme_void() +
    labs(fill = NULL) +
    annotate("text", x = df.vdc$x, y = df.vdc$y, label = df.vdc$Count, size = 7) +
    ggtitle("Lipids upregulated in MDM2 High cells compared to MDM2 Low (Untreated)") +
    theme(legend.text=element_text(size=16))

untreated_DMEM_sig <- untreated_DMEM %>%
  filter(mypadj < 0.05, log2fc < -1)

untreated_STDP_sig <- untreated_STDP %>%
  filter(mypadj < 0.05, log2fc < -1)

df.venn <- data.frame(x = c(1.2, 0),
		      y = c(0, 0),
		      r = c(1.2,1),
		      labels = c('Standard Media', 'Sterol-Deprived Media'))
intersect_count = length(intersect(untreated_DMEM_sig$name,untreated_STDP_sig$name))
df.vdc<-data.frame(Count = c(intersect_count,
			     nrow(untreated_STDP_sig)-intersect_count,
			     nrow(untreated_DMEM_sig)-intersect_count),
		   x = c(.3, -.6, 1.5),
		   y = c(0,0,0))
figS3D.2 <- ggplot(df.venn, aes(x0 = x, y0 = y, r = r, fill = labels)) +
  scale_fill_brewer(palette="Dark2") +
  geom_circle(alpha = .5, size = 1, colour = 'grey') +
  coord_fixed() +
  theme_void() +
  labs(fill = NULL) +
  annotate("text", x = df.vdc$x, y = df.vdc$y, label = df.vdc$Count, size = 7) +
    ggtitle("Lipids upregulated in MDM2 Low cells compared to MDM2 High (Untreated)") +
    theme(legend.text=element_text(size=16))

plot_grid(figS3D.1,
	  figS3D.2,
	  ncol=1)

\end{verbatim}
\section{Additional figure: "Concordance of Metabolomic and Lipidomic Differences in MDM2 Low vs. High"}
\label{sec:orgedf5c09}

\begin{verbatim}
library(readxl)

lipidomics_classes<-
    read_excel("~/Desktop/Liposarcoma project/Lipidomics_key.xlsx",
	       sheet=1)
metabolomics_classes<-
    read_excel("~/Desktop/Liposarcoma project/Lipidomics_key.xlsx",
	       sheet=2)
untreated_DMEM_sig <- untreated_DMEM %>%
  filter(mypadj < 0.05, abs(log2fc) > 1)

resMDM2HiLoSig$mainclass <-
    metabolomics_classes$`LM Main Class`[match(resMDM2HiLoSig$name,
					       metabolomics_classes$name)] 

resMDM2HiLoSig <-
    resMDM2HiLoSig %>%
    filter(!is.na(mainclass)) %>%
    filter(mainclass != "Non-lipid in lipid pathways")

untreated_DMEM_sig$mainclass <-
    lipidomics_classes$`LM Main Class`[match(untreated_DMEM_sig$name,
					     lipidomics_classes$name)] 
fill <- c("#E1B378","#5F9EA0")

metabolites_hi <- resMDM2HiLoSig %>% filter(log2fc > 0)
lipids_hi <- untreated_DMEM_sig %>% filter(log2fc > 0) 

barplot_df_hi <-
    data.frame(mainclass = c(metabolites_hi$mainclass,lipids_hi$mainclass),
	       dataset = c(rep("Metabolomic",nrow(metabolites_hi)),
			   rep("Lipidomic",nrow(lipids_hi))),
	       direction = 1)

barplot_df_hi<-aggregate(direction ~ mainclass + dataset,
			 data=barplot_df_hi, FUN=sum)

metabolites_lo <- resMDM2HiLoSig %>% filter(log2fc < 0)
lipids_lo <- untreated_DMEM_sig %>% filter(log2fc < 0) 

barplot_df_lo <-
    data.frame(mainclass = c(metabolites_lo$mainclass,lipids_lo$mainclass),
	       dataset = c(rep("Metabolomic",nrow(metabolites_lo)),
			   rep("Lipidomic",nrow(lipids_lo))),
	       direction = -1)

barplot_df_lo<-aggregate(direction ~ mainclass + dataset,
			 data=barplot_df_lo, FUN=sum)
barplot_df <- rbind(barplot_df_hi,barplot_df_lo)

ggplot(barplot_df,aes(x=mainclass,fill = dataset,y = direction)) +
    geom_bar(stat="identity") +
    scale_fill_manual(values=fill) +
    theme(axis.title.y = element_blank(),
	  plot.margin = unit(c(1,3,1,1), "lines")) +
    scale_y_continuous("Count", breaks = seq(-15,5,5),
		       labels = c("15","10","5","0","5")) +
    geom_hline(yintercept=0) +
    coord_flip() +
    expand_limits(x = c(0, 16)) +
    ggtitle("Significant Differences between MDM2 High and Low Cells\nby LipidMaps Main Class") +
    annotate("text",y=-10,x=15.3,label = "Higher in MDM2 Low",size=3) +
    annotate("text",y=4,x=15.3,label = "Higher in MDM2 High",size=3)



\end{verbatim}
\end{document}
