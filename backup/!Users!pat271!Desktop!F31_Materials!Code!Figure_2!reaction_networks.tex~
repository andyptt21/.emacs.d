% Created 2019-03-07 Thu 11:26
% Intended LaTeX compiler: pdflatex
\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{grffile}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{textcomp}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\author{Andrew Patt}
\date{\textit{[2019-02-28 Thu]}}
\title{Building shared reaction network of metabolites}
\hypersetup{
 pdfauthor={Andrew Patt},
 pdftitle={Building shared reaction network of metabolites},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 25.3.1 (Org mode 9.2)}, 
 pdflang={English}}
\begin{document}

\maketitle


\section*{Build adjacency matrix}
\label{sec:orgb389ca0}
\begin{verbatim}
library(tidyverse)
reaction_table<-read.table("~/Desktop/F31_Materials/Data/Reactions/inchi_reactions.tsv",sep="\t")

metabolites<-unique(c(as.vector(reaction_table$V1),as.vector(reaction_table$V2)))
reaction_adjacency_matrix<-diag(length(metabolites))
colnames(reaction_adjacency_matrix)<-rownames(reaction_adjacency_matrix)<-metabolites

for(i in 1:nrow(reaction_table)){
  reaction_adjacency_matrix[reaction_table[i,1],reaction_table[i,2]]<-reaction_table[i,3]
}

\end{verbatim}

\section*{Visualize}
\label{sec:org71a6bc4}
ggnet

\begin{verbatim}
library(GGally)
library(network)
library(sna)
library(ggplot2)
library(RColorBrewer)

reaction_network = network(reaction_adjacency_matrix,
	      matrix.type = "adjacency",
	      ignore.eval = FALSE,
	      names.eval = "weights")

newcol<-colorRampPalette(brewer.pal(9,"RdYlBu"))
ncols<-max(degree(reaction_network))
palette<-rev(newcol(ncols))

set.vertex.attribute(reaction_network,"color",palette[degree(reaction_network)])

p<-ggnet2(reaction_network, label = FALSE,size = "degree",
       size.min = 1,color = "color") +
  guides(size = F) +
  ggtitle("Metabolite Reaction Network, HumanCyc")

p

\end{verbatim}

netbiov
\begin{verbatim}
library(netbiov)
library(igraph)

## for(i in 1:nrow(reaction_adjacency_matrix)){
##   write.table(rownames(reaction_adjacency_matrix)[i],file=paste0("inchis/",i,".inchi"),
##               row.names=FALSE,col.names=FALSE,sep="\t",quote=FALSE)
## }


reaction_igraph<-graph.adjacency(reaction_adjacency_matrix,mode="undirected",weighted=TRUE,diag=F)
reaction_igraph<-igraph::delete.vertices(reaction_igraph,igraph::degree(reaction_igraph)==0)
igraph_plot<-plot.modules(reaction_igraph,mod.lab=TRUE, mod.edge.col="white",color.random = TRUE,
			  ed.color="grey28", sf=15, v.size=1,layout.function=layout.graphopt,
			  lab.color="white", modules.name.num=FALSE, lab.cex=2, lab.dist=5)

\end{verbatim}

\begin{itemize}
\item How are the modules identified?
\label{sec:org5c51a37}
Fast-greedy algorithm
\item Any biological significance to modules?
\label{sec:org81ca12b}
\end{itemize}

\section*{Analyze structure}
\label{sec:org6d88ea3}

Need to get a key for translating Inchis to KEGG/common names.

\begin{verbatim}
setwd("inchikeys/")
file_list <- list.files()
for (file in file_list){
  if (!exists("dataset")){
    dataset <- read.table(file, header=FALSE, sep="\t")
  }
  if (exists("dataset")){
    temp_dataset <-read.table(file, header=FALSE, sep="\t")
    dataset<-rbind(dataset, temp_dataset)
    rm(temp_dataset)
  }
}

inchikeys<-dataset
rm(dataset)

setwd("../inchis/")
file_list <- list.files()
for (file in file_list){
  if (!exists("dataset")){
    dataset <- read.table(file, header=FALSE, sep="\t")
  }
  if (exists("dataset")){
    temp_dataset <-read.table(file, header=FALSE, sep="\t")
    dataset<-rbind(dataset, temp_dataset)
    rm(temp_dataset)
  }
}

inchis<-dataset
rm(dataset)

setwd("~/Desktop/Pathway_Analysis/Structure_Analysis/kegg_inchikeys/")
file_list <- list.files()

for (file in file_list){
  if (!exists("dataset")){
    dataset <- read.table(file, header=FALSE, sep="\t")
  }
  if (exists("dataset")){
    if(file.info(file)$size!=0){
      temp_dataset <-read.table(file, header=FALSE, sep="\t")
      dataset<-rbind(dataset, temp_dataset)
      rm(temp_dataset)
    }
  }
}
file_list<-gsub(".inchikey","",file_list)
dataset<-cbind(dataset,file_list)

\end{verbatim}

For some reason I get 9 modules here but 11 up there

\begin{verbatim}
reaction_modules<-cluster_fast_greedy(reaction_igraph)
length(reaction_modules)
sizes(reaction_modules)

reaction_membership<-membership(reaction_modules)
\end{verbatim}
\end{document}